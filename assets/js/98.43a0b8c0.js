(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{371:function(t,a,s){"use strict";s.r(a);var e=s(14),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"react虚拟dom的理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#react虚拟dom的理解"}},[t._v("#")]),t._v(" React虚拟DOM的理解")]),t._v(" "),a("p",[a("code",[t._v("Virtual DOM")]),t._v("是一棵以"),a("code",[t._v("JavaScript")]),t._v("对象作为基础的树，每一个节点可以将其称为"),a("code",[t._v("VNode")]),t._v("，用对象属性来描述节点，实际上它是一层对真实"),a("code",[t._v("DOM")]),t._v("的抽象，最终可以通过渲染操作使这棵树映射到真实环境上，简单来说"),a("code",[t._v("Virtual DOM")]),t._v("就是一个"),a("code",[t._v("Js")]),t._v("对象，是更加轻量级的对"),a("code",[t._v("DOM")]),t._v("的描述，用以表示整个文档。")]),t._v(" "),a("h2",{attrs:{id:"描述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#描述"}},[t._v("#")]),t._v(" 描述")]),t._v(" "),a("p",[t._v("在浏览器中构建页面时需要使用"),a("code",[t._v("DOM")]),t._v("节点描述整个文档。")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("1"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("11"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("如果使用"),a("code",[t._v("Js")]),t._v("对象去描述上述的节点以及文档，那么便类似于下面的样子。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tag"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tagName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("attr")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("className")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("parent")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("children")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tag"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tagName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"p"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("attr")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("parent")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 父节点的引用 */")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("children")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tagName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("parent")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 父节点的引用 */")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tag"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tagName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("attr")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("parent")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 父节点的引用 */")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("children")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tagName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("parent")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 父节点的引用 */")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"11"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"react中的虚拟dom"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#react中的虚拟dom"}},[t._v("#")]),t._v(" React中的虚拟DOM")]),t._v(" "),a("p",[a("code",[t._v("Virtual DOM")]),t._v("是一种编程概念，在这个概念里，"),a("code",[t._v("UI")]),t._v("以一种理想化的，或者说虚拟的表现形式被保存于内存中，并通过如"),a("code",[t._v("ReactDOM")]),t._v("等类库使之与真实的"),a("code",[t._v("DOM")]),t._v("同步，这一过程叫做协调。这种方式赋予了"),a("code",[t._v("React")]),t._v("声明式的"),a("code",[t._v("API")]),t._v("，您告诉"),a("code",[t._v("React")]),t._v("希望让"),a("code",[t._v("UI")]),t._v("是什么状态，"),a("code",[t._v("React")]),t._v("就确保"),a("code",[t._v("DOM")]),t._v("匹配该状态，这样可以从属性操作、事件处理和手动"),a("code",[t._v("DOM")]),t._v("更新这些在构建应用程序时必要的操作中解放出来。"),a("br"),t._v("\n与其将"),a("code",[t._v("Virtual DOM")]),t._v("视为一种技术，不如说它是一种模式，人们提到它时经常是要表达不同的东西。在"),a("code",[t._v("React")]),t._v("的世界里，术语"),a("code",[t._v("Virtual DOM")]),t._v("通常与"),a("code",[t._v("React")]),t._v("元素关联在一起，因为它们都是代表了用户界面的对象，而"),a("code",[t._v("React")]),t._v("也使用一个名为"),a("code",[t._v("fibers")]),t._v("的内部对象来存放组件树的附加信息，上述二者也被认为是"),a("code",[t._v("React")]),t._v("中"),a("code",[t._v("Virtual DOM")]),t._v(" 实现的一部分。")]),t._v(" "),a("h3",{attrs:{id:"react中的虚拟dom的历史"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#react中的虚拟dom的历史"}},[t._v("#")]),t._v(" React中的虚拟DOM的历史")]),t._v(" "),a("p",[t._v("在之前，"),a("code",[t._v("Facebook")]),t._v("是"),a("code",[t._v("PHP")]),t._v("大户，所以"),a("code",[t._v("React")]),t._v("最开始的灵感就来自于"),a("code",[t._v("PHP")]),t._v("。"),a("br"),t._v("\n在"),a("code",[t._v("2004")]),t._v("年这个时候，大家都还在用"),a("code",[t._v("PHP")]),t._v("的字符串拼接来开发网站。")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$str")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"<ul>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("foreach")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$talks")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$talk")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$str")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"<li>"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$talk")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"</li>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$str")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"</ul>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("这种方式代码写出来不好看不说，还容易造成"),a("code",[t._v("XSS")]),t._v("等安全问题。应对方法是对用户的任何输入都进行转义"),a("code",[t._v("Escape")]),t._v("，但是如果对字符串进行多次转义，那么反转义的次数也必须是相同的，否则会无法得到原内容，如果又不小心把"),a("code",[t._v("HTML")]),t._v("标签给转义了，那么"),a("code",[t._v("HTML")]),t._v("标签会直接显示给用户，从而导致很差的用户体验。"),a("br"),t._v("\n到了"),a("code",[t._v("2010")]),t._v("年，为了更加高效的编码，同时也避免转义"),a("code",[t._v("HTML")]),t._v("标签的错误，"),a("code",[t._v("Facebook")]),t._v("开发了"),a("code",[t._v("XHP")]),t._v("。"),a("code",[t._v("XHP")]),t._v("是对"),a("code",[t._v("PHP")]),t._v("的语法拓展，它允许开发者直接在"),a("code",[t._v("PHP")]),t._v("中使用"),a("code",[t._v("HTML")]),t._v("标签，而不再使用字符串。")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$content")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("ul "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("foreach")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$talks")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$talk")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$content")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("li"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$talk")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("li"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("这样的话，所有"),a("code",[t._v("HTML")]),t._v("标签都使用不同于"),a("code",[t._v("PHP")]),t._v("的语法，我们可以轻易的分辨哪些需要转义哪些不需要转义。不久的后来，"),a("code",[t._v("Facebook")]),t._v("的工程师又发现他们还可以创建自定义标签，而且通过组合自定义标签有助于构建大型应用。"),a("br"),t._v("\n到了"),a("code",[t._v("2013")]),t._v("年，前端工程师"),a("code",[t._v("Jordan Walke")]),t._v("向他的经理提出了一个大胆的想法：把"),a("code",[t._v("XHP")]),t._v("的拓展功能迁移到"),a("code",[t._v("Js")]),t._v("中，首要任务是需要一个拓展来让"),a("code",[t._v("JS")]),t._v("支持"),a("code",[t._v("XML")]),t._v("语法，该拓展称为"),a("code",[t._v("JSX")]),t._v("。因为当时由于"),a("code",[t._v("Node.js")]),t._v("在"),a("code",[t._v("Facebook")]),t._v("已经有很多实践，所以很快就实现了"),a("code",[t._v("JSX")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-jsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-jsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" content "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TalkList")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n    ")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("talks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("talk")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Talk")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("talk")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("talk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n  ")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TalkList")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("在这个时候，就有另外一个很棘手的问题，那就是在进行更新的时候，需要去操作"),a("code",[t._v("DOM")]),t._v("，传统 "),a("code",[t._v("DOM API")]),t._v("细节太多，操作复杂，所以就很容易出现"),a("code",[t._v("Bug")]),t._v("，而且代码难以维护。然后就想到了"),a("code",[t._v("PHP")]),t._v("时代的更新机制，每当有数据改变时，只需要跳到一个由"),a("code",[t._v("PHP")]),t._v("全新渲染的新页面即可。\n从开发者的角度来看的话，这种方式开发应用是非常简单的，因为它不需要担心变更，且界面上用户数据改变时所有内容都是同步的。为此"),a("code",[t._v("React")]),t._v("提出了一个新的思想，即始终整体刷新页面，当发生前后状态变化时，"),a("code",[t._v("React")]),t._v("会自动更新"),a("code",[t._v("UI")]),t._v("，让我们从复杂的"),a("code",[t._v("UI")]),t._v("操作中解放出来，使我们只需关于状态以及最终"),a("code",[t._v("UI")]),t._v("长什么样。这个时候，我只需要关系我的状态(数据是什么)，以及"),a("code",[t._v("UI")]),t._v("长什么样(布局)，不再需要关系操作细节。"),a("br"),t._v("\n这种方式虽然简单粗暴，但是很明显的缺点，就是很慢。另外还有一个问题就是这样无法包含节点的状态，比如它会失去当前聚焦的元素和光标，以及文本选择和页面滚动位置，这些都是页面的当前状态。"),a("br"),t._v("\n为了解决上面说的问题，对于没有改变的"),a("code",[t._v("DOM")]),t._v("节点，让它保持原样不动，仅仅创建并替换变更过的"),a("code",[t._v("DOM")]),t._v("节点，这种方式实现了"),a("code",[t._v("DOM")]),t._v("节点复用"),a("code",[t._v("Reuse")]),t._v("。至此，只要能够识别出哪些节点改变了，那么就可以实现对"),a("code",[t._v("DOM")]),t._v("的更新，于是问题就转化为如何比对两个"),a("code",[t._v("DOM")]),t._v("的差异。说到对比差异，可能很容易想到版本控制"),a("code",[t._v("git")]),t._v("。"),a("code",[t._v("DOM")]),t._v("是树形结构，所以"),a("code",[t._v("diff")]),t._v("算法必须是针对树形结构的，目前已知的完整树形结构的编辑距离"),a("code",[t._v("diff")]),t._v("算法复杂度为"),a("code",[t._v("O(n^3)")]),t._v("。但是时间复杂度"),a("code",[t._v("O(n^3)")]),t._v("太高了，所以"),a("code",[t._v("Facebook")]),t._v("工程师考虑到组件的特殊情况，进行了一些优化与折中，然后将复杂度降低到了"),a("code",[t._v("O(n)")]),t._v("。"),a("br"),t._v(" "),a("code",[t._v("DOM")]),t._v("是复杂的，对它的操作尤其是查询和创建是非常慢非常耗费资源的。看下面的例子，仅创建一个空白的"),a("code",[t._v("div")]),t._v("，其实例属性就达到"),a("code",[t._v("294")]),t._v("个。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Chrome v84")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" div "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" m "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" k "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" div"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" m"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 294")]),t._v("\n")])])]),a("p",[t._v("对于"),a("code",[t._v("DOM")]),t._v("这么多属性，其实大部分属性对于做"),a("code",[t._v("Diff")]),t._v("是没有任何用处的，所以如果用更轻量级的"),a("code",[t._v("Js")]),t._v("对象来代替复杂的"),a("code",[t._v("DOM")]),t._v("节点，然后把对"),a("code",[t._v("DOM")]),t._v("的"),a("code",[t._v("diff")]),t._v("操作转移到"),a("code",[t._v("Js")]),t._v("对象，就可以避免大量对"),a("code",[t._v("DOM")]),t._v("的查询操作。这个更轻量级的"),a("code",[t._v("Js")]),t._v("对象就称为"),a("code",[t._v("Virtual DOM")]),t._v("。那么现在的过程就是这样：")]),t._v(" "),a("ul",[a("li",[t._v("维护一个使用"),a("code",[t._v("Js")]),t._v("对象表示的"),a("code",[t._v("Virtual DOM")]),t._v("，与真实"),a("code",[t._v("DOM")]),t._v("一一对应。")]),t._v(" "),a("li",[t._v("对前后两个"),a("code",[t._v("Virtual DOM")]),t._v("做"),a("code",[t._v("diff")]),t._v("，生成变更"),a("code",[t._v("Mutation")]),t._v("。")]),t._v(" "),a("li",[t._v("把变更应用于真实"),a("code",[t._v("DOM")]),t._v("，生成最新的真实"),a("code",[t._v("DOM")]),t._v("。")])]),t._v(" "),a("p",[t._v("可以看出，因为要把变更应用到真实"),a("code",[t._v("DOM")]),t._v("上，所以还是避免不了要直接操作"),a("code",[t._v("DOM")]),t._v("，但是"),a("code",[t._v("React")]),t._v("的"),a("code",[t._v("diff")]),t._v("算法会把"),a("code",[t._v("DOM")]),t._v("改动次数降到最低。关于"),a("code",[t._v("React")]),t._v("中的虚拟"),a("code",[t._v("DOM")]),t._v("创建过程可以参考"),a("code",[t._v("https://github.com/facebook/react/blob/9198a5cec0936a21a5ba194a22fcbac03eba5d1d/packages/react/src/ReactElement.js#L348")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("传统前端的编程方式是命令式的，直接操纵"),a("code",[t._v("DOM")]),t._v("，告诉浏览器该怎么干，这样的问题就是，大量的代码被用于操作"),a("code",[t._v("DOM")]),t._v("元素，且代码可读性差，可维护性低。"),a("code",[t._v("React")]),t._v("的出现，将命令式变成了声明式，摒弃了直接操作"),a("code",[t._v("DOM")]),t._v("的细节，只关注数据的变动，"),a("code",[t._v("DOM")]),t._v("操作由框架来完成，从而大幅度提升了代码的可读性和可维护性。"),a("br"),t._v("\n在初期我们可以看到，数据的变动导致整个页面的刷新，这种效率很低，因为可能是局部的数据变化，但是要刷新整个页面，造成了不必要的开销。所以就有了"),a("code",[t._v("Diff")]),t._v("过程，将数据变动前后的"),a("code",[t._v("DOM")]),t._v("结构先进行比较，找出两者的不同处，然后再对不同之处进行更新渲染。但是由于整个"),a("code",[t._v("DOM")]),t._v("结构又太大，所以采用了更轻量级的对"),a("code",[t._v("DOM")]),t._v("的描述—虚拟"),a("code",[t._v("DOM")]),t._v("。"),a("br"),t._v("\n不过需要注意的是，虚拟"),a("code",[t._v("DOM")]),t._v("和"),a("code",[t._v("Diff")]),t._v("算法的出现是为了解决由命令式编程转变为声明式编程、数据驱动后所带来的性能问题的。换句话说，直接操作"),a("code",[t._v("DOM")]),t._v("的性能并不会低于虚拟"),a("code",[t._v("DOM")]),t._v("和"),a("code",[t._v("Diff")]),t._v("算法，甚至还会优于。框架的意义在于为你掩盖底层的"),a("code",[t._v("DOM")]),t._v("操作，让你用更声明式的方式来描述你的目的，从而让你的代码更容易维护，没有任何框架可以比纯手动的优化"),a("code",[t._v("DOM")]),t._v("操作更快，因为框架的"),a("code",[t._v("DOM")]),t._v("操作层需要应对任何上层"),a("code",[t._v("API")]),t._v("可能产生的操作，它的实现必须是普适的。")]),t._v(" "),a("h2",{attrs:{id:"虚拟dom优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#虚拟dom优缺点"}},[t._v("#")]),t._v(" 虚拟DOM优缺点")]),t._v(" "),a("h3",{attrs:{id:"优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[t._v("#")]),t._v(" 优点")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Virtual DOM")]),t._v("在牺牲(牺牲很关键)部分性能的前提下，增加了可维护性，这也是很多框架的通性。")]),t._v(" "),a("li",[t._v("实现了对"),a("code",[t._v("DOM")]),t._v("的集中化操作，在数据改变时先对虚拟"),a("code",[t._v("DOM")]),t._v("进行修改，再反映到真实的"),a("code",[t._v("DOM")]),t._v("，用最小的代价来更新"),a("code",[t._v("DOM")]),t._v("，提高效率。")]),t._v(" "),a("li",[t._v("打开了函数式"),a("code",[t._v("UI")]),t._v("编程的大门。")]),t._v(" "),a("li",[t._v("可以渲染到"),a("code",[t._v("DOM")]),t._v("以外的端，使得框架跨平台，比如"),a("code",[t._v("ReactNative")]),t._v("，"),a("code",[t._v("React VR")]),t._v("等。")]),t._v(" "),a("li",[t._v("可以更好的实现"),a("code",[t._v("SSR")]),t._v("，同构渲染等。")]),t._v(" "),a("li",[t._v("组件的高度抽象化。")])]),t._v(" "),a("h3",{attrs:{id:"缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[t._v("#")]),t._v(" 缺点")]),t._v(" "),a("ul",[a("li",[t._v("首次渲染大量"),a("code",[t._v("DOM")]),t._v("时，由于多了一层虚拟"),a("code",[t._v("DOM")]),t._v("的计算，会比"),a("code",[t._v("innerHTML")]),t._v("插入慢。")]),t._v(" "),a("li",[t._v("虚拟"),a("code",[t._v("DOM")]),t._v("需要在内存中的维护一份"),a("code",[t._v("DOM")]),t._v("的副本，多占用了部分内存。")]),t._v(" "),a("li",[t._v("如果虚拟"),a("code",[t._v("DOM")]),t._v("大量更改，这是合适的。但是单一的、频繁的更新的话，虚拟"),a("code",[t._v("DOM")]),t._v("将会花费更多的时间处理计算的工作。所以如果你有一个"),a("code",[t._v("DOM")]),t._v("节点相对较少页面，用虚拟"),a("code",[t._v("DOM")]),t._v("，它实际上有可能会更慢，但对于大多数单页面应用，这应该都会更快。")])]),t._v(" "),a("h2",{attrs:{id:"每日一题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#每日一题"}},[t._v("#")]),t._v(" 每日一题")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("https://github.com/WindrunnerMax/EveryDay\n")])])]),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("https://zhuanlan.zhihu.com/p/99973075\nhttps://www.jianshu.com/p/e0a3ac85db5c\nhttps://www.jianshu.com/p/9a1d2750457f\nhttps://github.com/livoras/blog/issues/13\nhttps://juejin.cn/post/6844904165026562056\nhttps://juejin.cn/post/6844903640512086029\nhttps://zh-hans.reactjs.org/docs/faq-internals.html#what-is-the-virtual-dom\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);